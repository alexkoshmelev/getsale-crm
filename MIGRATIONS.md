# Database Migrations & Seeding

## üöÄ Production-Ready Setup

–ú—ã –∏—Å–ø–æ–ª—å–∑—É–µ–º **Knex.js** - industry standard –¥–ª—è –º–∏–≥—Ä–∞—Ü–∏–π –≤ Node.js, –∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π —Ç—ã—Å—è—á–∞–º–∏ –∫–æ–º–ø–∞–Ω–∏–π –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ.

## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

–ü–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞ `docker compose up -d` –º–∏–≥—Ä–∞—Ü–∏–∏ –≤—ã–ø–æ–ª–Ω—è—é—Ç—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —á–µ—Ä–µ–∑ —Å–µ—Ä–≤–∏—Å `migrations`.

## –†—É—á–Ω–æ–π –∑–∞–ø—É—Å–∫

### –ú–∏–≥—Ä–∞—Ü–∏–∏

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å –≤—Å–µ –º–∏–≥—Ä–∞—Ü–∏–∏
docker compose run --rm migrations npm run migrate

# –û—Ç–∫–∞—Ç–∏—Ç—å –ø–æ—Å–ª–µ–¥–Ω—é—é –º–∏–≥—Ä–∞—Ü–∏—é
docker compose run --rm migrations npm run migrate:rollback

# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Å—Ç–∞—Ç—É—Å –º–∏–≥—Ä–∞—Ü–∏–π
docker compose run --rm migrations npm run migrate:status

# –ò–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ (–µ—Å–ª–∏ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏)
cd migrations
npm install
npm run migrate
```

### Seed –¥–∞–Ω–Ω—ã—Ö

```bash
# –ó–∞–ø—É—Å—Ç–∏—Ç—å seed
docker compose run --rm migrations npm run seed

# –ò–ª–∏ –ª–æ–∫–∞–ª—å–Ω–æ
cd migrations
npm run seed
```

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞

```
migrations/
  migrations/              # –§–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π (—Å timestamp)
    - 20241225000001_initial_schema.ts
  seeds/                   # Seed —Ñ–∞–π–ª—ã
    - 001_initial_data.ts
  knexfile.ts             # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Knex
  run-migrations.ts        # –°–∫—Ä–∏–ø—Ç –∑–∞–ø—É—Å–∫–∞ –º–∏–≥—Ä–∞—Ü–∏–π
```

## –î–µ—Ñ–æ–ª—Ç–Ω—ã–µ —É—á–µ—Ç–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è seed:

- **–ê–¥–º–∏–Ω**: `admin@getsale.com` / `admin123`
- **–¢–µ—Å—Ç–æ–≤—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å**: `test@getsale.com` / `test123`

## –°–æ–∑–¥–∞–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π

```bash
cd migrations
npm run migrate:make –Ω–∞–∑–≤–∞–Ω–∏–µ_–º–∏–≥—Ä–∞—Ü–∏–∏
```

Knex –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ —Å–æ–∑–¥–∞—Å—Ç —Ñ–∞–π–ª —Å timestamp –≤ —Ñ–æ—Ä–º–∞—Ç–µ `YYYYMMDDHHMMSS_–Ω–∞–∑–≤–∞–Ω–∏–µ_–º–∏–≥—Ä–∞—Ü–∏–∏.ts`.

## –ü–æ—á–µ–º—É Knex.js?

‚úÖ **Production-ready** - –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –≤ –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ —Ç—ã—Å—è—á–∞–º–∏ –∫–æ–º–ø–∞–Ω–∏–π  
‚úÖ **–ù–∞–¥–µ–∂–Ω—ã–π** - –ü—Ä–æ–≤–µ—Ä–µ–Ω –≤—Ä–µ–º–µ–Ω–µ–º, –æ—Ç–ª–∏—á–Ω–∞—è –æ–±—Ä–∞–±–æ—Ç–∫–∞ –æ—à–∏–±–æ–∫  
‚úÖ **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–æ–Ω–Ω—ã–π** - –ö–∞–∂–¥–∞—è –º–∏–≥—Ä–∞—Ü–∏—è –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏  
‚úÖ **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã—Ö –º–∏–≥—Ä–∞—Ü–∏–π  
‚úÖ **–û—Ç–∫–∞—Ç** - –õ–µ–≥–∫–∏–π –æ—Ç–∫–∞—Ç –º–∏–≥—Ä–∞—Ü–∏–π  
‚úÖ **TypeScript** - –ü–æ–ª–Ω–∞—è –ø–æ–¥–¥–µ—Ä–∂–∫–∞ TypeScript  
‚úÖ **–ë–µ–∑ ORM** - –†–∞–±–æ—Ç–∞–µ—Ç —Å raw SQL, –∏–¥–µ–∞–ª—å–Ω–æ –¥–ª—è –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–æ–≤  

## Best Practices –¥–ª—è –ø—Ä–æ–¥–∞–∫—à–µ–Ω–∞

1. **–í—Å–µ–≥–¥–∞ —Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –º–∏–≥—Ä–∞—Ü–∏–∏** - –¢–µ—Å—Ç–∏—Ä—É–π—Ç–µ `up` –∏ `down` –ª–æ–∫–∞–ª—å–Ω–æ
2. **–ë—ç–∫–∞–ø –ø–µ—Ä–µ–¥ –º–∏–≥—Ä–∞—Ü–∏–µ–π** - –í—Å–µ–≥–¥–∞ –¥–µ–ª–∞–π—Ç–µ –±—ç–∫–∞–ø –ø—Ä–æ–¥–∞–∫—à–Ω –ë–î
3. **–¢—Ä–∞–Ω–∑–∞–∫—Ü–∏–∏** - Knex –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤—ã–ø–æ–ª–Ω—è–µ—Ç –º–∏–≥—Ä–∞—Ü–∏–∏ –≤ —Ç—Ä–∞–Ω–∑–∞–∫—Ü–∏—è—Ö
4. **–í–µ—Ä—Å–∏–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ** - –ö–æ–º–º–∏—Ç—å—Ç–µ –≤—Å–µ —Ñ–∞–π–ª—ã –º–∏–≥—Ä–∞—Ü–∏–π –≤ git
5. **–ù–µ –∏–∑–º–µ–Ω—è–π—Ç–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–Ω—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏** - –°–æ–∑–¥–∞–≤–∞–π—Ç–µ –Ω–æ–≤—ã–µ –º–∏–≥—Ä–∞—Ü–∏–∏
6. **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥** - –ü—Ä–æ–≤–µ—Ä—è–π—Ç–µ —Ç–∞–±–ª–∏—Ü—É `knex_migrations` –¥–ª—è —Å—Ç–∞—Ç—É—Å–∞
7. **–ü–ª–∞–Ω –æ—Ç–∫–∞—Ç–∞** - –í—Å–µ–≥–¥–∞ –∏–º–µ–π—Ç–µ —Å—Ç—Ä–∞—Ç–µ–≥–∏—é –æ—Ç–∫–∞—Ç–∞
