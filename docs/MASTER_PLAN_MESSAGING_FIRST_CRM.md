# Master Plan: Messaging-First AI-CRM

**–†–æ–ª—å:** Senior Product Architect + Lead Full-Stack Engineer  
**–¶–µ–ª—å:** –ú–∞—Å—à—Ç–∞–±–∏—Ä—É–µ–º–∞—è, –º—É–ª—å—Ç–∏-–≤–æ—Ä–∫—Å–ø–µ–π—Å–Ω–∞—è, AI-—É—Å–∏–ª–µ–Ω–Ω–∞—è CRM —Å Telegram-like UX.

---

## –ß–∞—Å—Ç—å 1. –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–Ω—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è

### 1.1 Multi-tenant –∏ –∏–∑–æ–ª—è—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –ò–∑–æ–ª—è—Ü–∏—è –ø–æ `organization_id` –≤–æ –≤—Å–µ—Ö —Ç–∞–±–ª–∏—Ü–∞—Ö; –æ–¥–∏–Ω –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –ø—Ä–∏–≤—è–∑–∞–Ω –∫ –æ–¥–Ω–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ (`users.organization_id`).

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- **–°–æ—Ö—Ä–∞–Ω–∏—Ç—å** –∏–∑–æ–ª—è—Ü–∏—é –ø–æ `organization_id` –∫–∞–∫ –æ—Å–Ω–æ–≤—É.
- **–î–æ–±–∞–≤–∏—Ç—å** —Å–ª–æ–π –º—É–ª—å—Ç–∏-–≤–æ—Ä–∫—Å–ø–µ–π—Å–∞: –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç —Å–æ—Å—Ç–æ—è—Ç—å –≤ –Ω–µ—Å–∫–æ–ª—å–∫–∏—Ö –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è—Ö. –î–ª—è —ç—Ç–æ–≥–æ –≤–≤–µ—Å—Ç–∏ —Ç–∞–±–ª–∏—Ü—É **`organization_members`** (user_id, organization_id, role, invited_by, joined_at, status). –¢–µ–∫—É—â–∏–π ¬´–∞–∫—Ç–∏–≤–Ω—ã–π¬ª workspace —Ö—Ä–∞–Ω–∏—Ç—å –≤ —Å–µ—Å—Å–∏–∏/JWT (`active_organization_id`). –ü—Ä–∏ —Å–º–µ–Ω–µ –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞ ‚Äî –Ω–æ–≤—ã–π JWT –∏–ª–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-Organization-Id` —Å –ø—Ä–æ–≤–µ—Ä–∫–æ–π —á–ª–µ–Ω—Å—Ç–≤–∞ –Ω–∞ –±—ç–∫–µ–Ω–¥–µ.
- **Data-–∏–∑–æ–ª—è—Ü–∏—è:** –≤—Å–µ –∑–∞–ø—Ä–æ—Å—ã (CRM, messaging, BD accounts, team) —Ñ–∏–ª—å—Ç—Ä–æ–≤–∞—Ç—å –ø–æ `organization_id` –∏–∑ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ –∑–∞–ø—Ä–æ—Å–∞ (–∏–∑ JWT –∏–ª–∏ –∑–∞–≥–æ–ª–æ–≤–∫–∞). –ù–∏–∫–æ–≥–¥–∞ –Ω–µ –≤–æ–∑–≤—Ä–∞—â–∞—Ç—å –¥–∞–Ω–Ω—ã–µ –¥—Ä—É–≥–æ–π –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏.

**–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ:** –ú–∞—Å—à—Ç–∞–± B2B, –Ω–µ—Å–∫–æ–ª—å–∫–æ –∫–æ–º–∞–Ω–¥/–±—Ä–µ–Ω–¥–æ–≤ —É –æ–¥–Ω–æ–≥–æ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è, —Ä–æ—Å—Ç retention.

---

### 1.2 –†–æ–ª–∏ –∏ –¥–æ—Å—Ç—É–ø—ã

**–¢–µ–∫—É—â–µ–µ —Å–æ—Å—Ç–æ—è–Ω–∏–µ:** –†–æ–ª–∏ –≤ `users.role` –∏ –≤ shared/types (OWNER, ADMIN, SUPERVISOR, BIDI, VIEWER); –≤ team-service –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è owner, admin, member.

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- **–£–Ω–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å —Ä–æ–ª–∏:** Owner, Admin, Manager, Agent, Viewer.
- **Owner:** –ø–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø, –ø–µ—Ä–µ–¥–∞—á–∞ –≤–ª–∞–¥–µ–Ω–∏—è, —É–¥–∞–ª–µ–Ω–∏–µ –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞.
- **Admin:** —É—á–∞—Å—Ç–Ω–∏–∫–∏, –∏–Ω–≤–∞–π—Ç—ã, –Ω–∞—Å—Ç—Ä–æ–π–∫–∏, –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏; –±–µ–∑ —É–¥–∞–ª–µ–Ω–∏—è –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞.
- **Manager:** —á–∞—Ç—ã, –∫–ª–∏–µ–Ω—Ç—ã, —Å–¥–µ–ª–∫–∏, –æ—Ç—á—ë—Ç—ã; –±–µ–∑ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —É—á–∞—Å—Ç–Ω–∏–∫–∞–º–∏.
- **Agent:** —á–∞—Ç—ã –∏ –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω—ã–µ –∫–ª–∏–µ–Ω—Ç—ã/—Å–¥–µ–ª–∫–∏.
- **Viewer:** —Ç–æ–ª—å–∫–æ –ø—Ä–æ—Å–º–æ—Ç—Ä.
- **–ì—Ä–∞–Ω—É–ª—è—Ä–Ω—ã–µ –ø—Ä–∞–≤–∞ (v2):** —Ç–∞–±–ª–∏—Ü–∞ `role_permissions` (role, resource, actions) –∏–ª–∏ JSONB –≤ —Ä–æ–ª–∏ –¥–ª—è —Ä–µ—Å—É—Ä—Å–æ–≤: chats, clients, deals, integrations.

**–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ:** –°–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–∏–µ –æ–∂–∏–¥–∞–Ω–∏—è–º enterprise, –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç—å, –¥–µ–ª–µ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ.

---

### 1.3 Invite-links –∏ –º—É–ª—å—Ç–∏-–≤–æ—Ä–∫—Å–ø–µ–π—Å

**–ü—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–µ:**

- –¢–∞–±–ª–∏—Ü–∞ **`organization_invite_links`**: organization_id, token, role, expires_at, created_by. –ü—É–±–ª–∏—á–Ω–∞—è —Å—Å—ã–ª–∫–∞ –¥–ª—è –ø—Ä–∏—Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è –∫ –≤–æ—Ä–∫—Å–ø–µ–π—Å—É.
- **–ù–µ–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ —Å—Å—ã–ª–∫–µ ‚Üí —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è ‚Üí Sign up ‚Üí —Å–æ–∑–¥–∞–Ω–∏–µ user + –∑–∞–ø–∏—Å—å –≤ organization_members —Å —Ä–æ–ª—å—é –∏–∑ –∏–Ω–≤–∞–π—Ç–∞; –∞–∫—Ç–∏–≤–Ω—ã–π workspace = —ç—Ç–∞ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏—è.
- **–ó–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å:** –ø–µ—Ä–µ—Ö–æ–¥ –ø–æ —Å—Å—ã–ª–∫–µ ‚Üí —Å—Ç—Ä–∞–Ω–∏—Ü–∞ ¬´–ü—Ä–∏—Å–æ–µ–¥–∏–Ω–∏—Ç—å—Å—è –∫ [Workspace]¬ª ‚Üí Accept ‚Üí INSERT –≤ organization_members (–±–µ–∑ —Å–º–µ–Ω—ã —Ç–µ–∫—É—â–µ–π org –¥–æ –ø–µ—Ä–µ–∫–ª—é—á–µ–Ω–∏—è). –ü–æ—Å–ª–µ accept ‚Äî –ø–æ–∫–∞–∑–∞—Ç—å –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤–æ—Ä–∫—Å–ø–µ–π—Å–æ–≤ –∏–ª–∏ —Ä–µ–¥–∏—Ä–µ–∫—Ç –≤ –Ω–æ–≤—ã–π –≤–æ—Ä–∫—Å–ø–µ–π—Å.
- **–ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–µ–π:** –ø–µ—Ä–µ–¥ —Å–æ–∑–¥–∞–Ω–∏–µ–º –∏–Ω–≤–∞–π—Ç–∞/accept –ø—Ä–æ–≤–µ—Ä—è—Ç—å (email –∏–ª–∏ user_id, organization_id) –≤ organization_members –∏ –≤ pending invitations.

**–ü–æ—á–µ–º—É –≤–∞–∂–Ω–æ:** –í–∏—Ä–∞–ª—å–Ω–æ—Å—Ç—å, –æ–Ω–±–æ—Ä–¥–∏–Ω–≥ –∫–æ–º–∞–Ω–¥, ¬´–∫–∞–∫ –≤ Slack/Notion¬ª.

---

### 1.4 Audit logs, rate limits, RBAC

- **Audit logs:** —Ç–∞–±–ª–∏—Ü–∞ `audit_logs` (organization_id, user_id, action, resource_type, resource_id, old_value, new_value, ip, created_at). –ü–∏—Å–∞—Ç—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –¥–µ–π—Å—Ç–≤–∏—è: —É–¥–∞–ª–µ–Ω–∏–µ —Å—É—â–Ω–æ—Å—Ç–µ–π, —Å–º–µ–Ω–∞ —Ä–æ–ª–µ–π, —ç–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö, –≤—Ö–æ–¥ –≤ —Å–∏—Å—Ç–µ–º—É.
- **Rate limits:** –Ω–∞ API Gateway –ø–æ user_id –∏ –ø–æ organization_id (—Ä–∞–∑–Ω—ã–µ –ª–∏–º–∏—Ç—ã –¥–ª—è —á—Ç–µ–Ω–∏—è –∏ –¥–ª—è –æ—Ç–ø—Ä–∞–≤–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π). Redis –¥–ª—è —Å—á—ë—Ç—á–∏–∫–æ–≤.
- **RBAC:** middleware –Ω–∞ –∫–∞–∂–¥–æ–º —Å–µ—Ä–≤–∏—Å–µ: –ø–æ —Ä–æ–ª–∏ –∏–∑ JWT/–∫–æ–Ω—Ç–µ–∫—Å—Ç–∞ —Ä–∞–∑—Ä–µ—à–∞—Ç—å –∏–ª–∏ –∑–∞–ø—Ä–µ—â–∞—Ç—å –æ–ø–µ—Ä–∞—Ü–∏—é. –ü—Ä–∏ –º—É–ª—å—Ç–∏-–≤–æ—Ä–∫—Å–ø–µ–π—Å–µ ‚Äî —Ä–æ–ª—å –±—Ä–∞—Ç—å –∏–∑ organization_members –¥–ª—è active_organization_id.

---

### 1.5 Event-driven, background jobs, caching

- **Event-driven:** —Å–æ—Ö—Ä–∞–Ω–∏—Ç—å RabbitMQ –¥–ª—è message.received, deal.stage.changed, team.member.added –∏ —Ç.–¥. –î–æ–±–∞–≤–∏—Ç—å —Å–æ–±—ã—Ç–∏—è: invite.accepted, workspace.switched.
- **Background jobs:** —Ç—è–∂—ë–ª—ã–µ –æ–ø–µ—Ä–∞—Ü–∏–∏ (—Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –∏—Å—Ç–æ—Ä–∏–∏ Telegram, —ç–∫—Å–ø–æ—Ä—Ç –æ—Ç—á—ë—Ç–æ–≤, —Ä–∞—Å—Å—ã–ª–∫–∏) –≤—ã–Ω–æ—Å–∏—Ç—å –≤ –æ—á–µ—Ä–µ–¥—å (Bull/BullMQ –Ω–∞ Redis –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω—ã–π worker). –ù–µ –±–ª–æ–∫–∏—Ä–æ–≤–∞—Ç—å HTTP.
- **Caching:** Redis ‚Äî —Å–µ—Å—Å–∏–∏, rate limit, –∫—ç—à —Ç—è–∂—ë–ª—ã—Ö –æ—Ç–≤–µ—Ç–æ–≤ (—Å–ø–∏—Å–æ–∫ –ø–∞–ø–æ–∫/–¥–∏–∞–ª–æ–≥–æ–≤ –ø–æ –∞–∫–∫–∞—É–Ω—Ç—É) —Å TTL. –ù–∞ —Ñ—Ä–æ–Ω—Ç–µ ‚Äî LRU-–∫—ç—à blob URL –¥–ª—è –∞–≤–∞—Ç–∞—Ä–æ–∫ –∏ –º–µ–¥–∏–∞ (–∏–∑–±–µ–∂–∞—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω—ã—Ö –∑–∞–ø—Ä–æ—Å–æ–≤ –ø—Ä–∏ —Å–∫—Ä–æ–ª–ª–µ).

---

### 1.6 Unified Inbox (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ –ø–æ–¥ –æ–º–Ω–∏–∫–∞–Ω–∞–ª)

- –ê–±—Å—Ç—Ä–∞–∫—Ü–∏—è **–∫–∞–Ω–∞–ª:** telegram, whatsapp, email, instagram_dm, web_chat. –¢–∞–±–ª–∏—Ü–∞ **`channels`** (organization_id, type, config JSONB, external_id).
- **Conversation/thread:** –ø—Ä–∏–≤—è–∑–∫–∞ –∫ –∫–∞–Ω–∞–ª—É –∏ –∫ contact (–∏–ª–∏ –∫ –≤–Ω–µ—à–Ω–µ–º—É –∏–¥–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ç–æ—Ä—É). –û–¥–∏–Ω –∫–æ–Ω—Ç–∞–∫—Ç ‚Äî –Ω–µ—Å–∫–æ–ª—å–∫–æ conversations –ø–æ —Ä–∞–∑–Ω—ã–º –∫–∞–Ω–∞–ª–∞–º.
- **–ï–¥–∏–Ω—ã–π timeline:** API ¬´–≤—Å–µ —Å–æ–æ–±—â–µ–Ω–∏—è –ø–æ contact_id¬ª —Å –≥—Ä—É–ø–ø–∏—Ä–æ–≤–∫–æ–π –ø–æ –∫–∞–Ω–∞–ª—É –∏ —Å–æ—Ä—Ç–∏—Ä–æ–≤–∫–æ–π –ø–æ –≤—Ä–µ–º–µ–Ω–∏. UI ‚Äî –æ–¥–Ω–∞ –ª–µ–Ω—Ç–∞ –ø–æ –∫–ª–∏–µ–Ω—Ç—É.
- –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –ø–æ —ç—Ç–∞–ø–∞–º: v1 ‚Äî —Ç–æ–ª—å–∫–æ Telegram (–∫–∞–∫ —Å–µ–π—á–∞—Å); v2 ‚Äî —Å–ª–æ–π channels + conversations; –∑–∞—Ç–µ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –¥—Ä—É–≥–∏—Ö –∫–∞–Ω–∞–ª–æ–≤ –ø–æ –æ–¥–Ω–æ–º—É.

---

### 1.7 AI-first CRM (–∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞)

- **–í —á–∞—Ç–∞—Ö:** API summarize (POST /api/ai/chat/summarize), extract intent, auto-create lead/deal –ø–æ –ø—Ä–∞–≤–∏–ª–∞–º –∏–ª–∏ –ø–æ AI. –•—Ä–∞–Ω–µ–Ω–∏–µ —Å–∞–º–º–∞—Ä–∏ –≤ `ai_conversation_summaries` –∏–ª–∏ –≤ metadata.
- **Pipeline:** API suggestions –ø–æ deal (—Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥, –≤–µ—Ä–æ—è—Ç–Ω–æ—Å—Ç—å –∑–∞–∫—Ä—ã—Ç–∏—è) –Ω–∞ –æ—Å–Ω–æ–≤–µ –∏—Å—Ç–æ—Ä–∏–∏ –∏ –∫–æ–Ω—Ç–µ–Ω—Ç–∞ —á–∞—Ç–∞. –í–∏–¥–∂–µ—Ç –≤ –∫–∞—Ä—Ç–æ—á–∫–µ —Å–¥–µ–ª–∫–∏.
- **Auto-tagging:** –ø—Ä–∏ message.received –∏–ª–∏ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–∏ ‚Äî –≤—ã–∑–æ–≤ AI –¥–ª—è —Ç–µ–≥–æ–≤ (—Ç–æ–Ω, –Ω–∞–º–µ—Ä–µ–Ω–∏–µ); —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ contact tags –∏–ª–∏ –≤ metadata —Å–æ–æ–±—â–µ–Ω–∏–π.

---

## –ß–∞—Å—Ç—å 2. –°–≤–æ–¥–∫–∞ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏–π ‚Üí –∑–∞–¥–∞—á–∏

### 2.1 UX/UI –∏–∑–º–µ–Ω–µ–Ω–∏—è

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –ó–∞–¥–∞—á–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°—Ç–∞—Ç—É—Å |
|------------|--------|-----------|--------|
| –í—ã–∫–ª—é—á–µ–Ω–∏–µ –∑–≤—É–∫–∞ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π | –ö–Ω–æ–ø–∫–∞ mute/unmute (–≤ —à–∞–ø–∫–µ/–Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö), —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ localStorage + store, –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ WebSocket –ø–µ—Ä–µ–¥ play | MVP | DONE |
| –°—Ç–∏–ª—å Telegram | Layout, –æ—Ç—Å—Ç—É–ø—ã (msg-bubble-out/in –≤ globals.css), —Ü–≤–µ—Ç–∞ –∏—Å—Ö./–≤—Ö., hover/active | MVP | DONE |
| –ì–∞–ª–æ—á–∫–∏ –ø—Ä–æ—á—Ç–µ–Ω–∏—è | 1 –≥–∞–ª–æ—á–∫–∞ = sent, 2 = read; –ø–æ status —Å–æ–æ–±—â–µ–Ω–∏—è –≤ –ë–î (Check/CheckCheck) | MVP | DONE |
| –°—Å—ã–ª–∫–∏ –∫–ª–∏–∫–∞–±–µ–ª—å–Ω—ã–µ | –ü–∞—Ä—Å–∏–Ω–≥ URL –≤ —Ç–µ–∫—Å—Ç–µ, —Ä–µ–Ω–¥–µ—Ä –∫–∞–∫ `<a>` (LinkifyText) | MVP | DONE |
| –§–æ—Ç–æ/–≤–∏–¥–µ–æ –ø–æ–≤–µ—Ä—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞ | Overlay/–º–æ–¥–∞–ª –ø–æ –∫–ª–∏–∫—É (MediaViewer), –Ω–µ –Ω–æ–≤–∞—è –≤–∫–ª–∞–¥–∫–∞; min-height –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã | MVP | DONE |
| –¢–µ–∫—Å—Ç/–∞—É–¥–∏–æ –∑–∞–≥—Ä—É–∂–∞—Ç—å —Å—Ä–∞–∑—É | –ë–µ–∑ –∫–Ω–æ–ø–∫–∏ ¬´–ó–∞–≥—Ä—É–∑–∏—Ç—å¬ª, –∫–∞–∫ —Å–µ–π—á–∞—Å | MVP | ‚Äî |
| AI-–ø–∞–Ω–µ–ª—å –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –æ—Ç–∫—Ä—ã—Ç–∞ | –ü—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∏–∑–∏—Ç–µ —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–∞ (stored !== 'false'); –∫–ª—é—á –≤ localStorage –ø—Ä–∏ —Å–≤–æ—Ä–∞—á–∏–≤–∞–Ω–∏–∏ | MVP | DONE |
| –°–∫—Ä–æ–ª–ª –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É —Å–æ–æ–±—â–µ–Ω–∏—é | scrollToBottom –ø—Ä–∏ —Å–º–µ–Ω–µ —á–∞—Ç–∞ + —Ç–∞–π–º–∞—É—Ç—ã 150/450 ms; min-height –¥–ª—è –º–µ–¥–∏–∞ | MVP | DONE |
| –ü–æ–¥–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –±–µ–∑ —Ñ—Ä–∏–∑–æ–≤ | Lazy load –≤–≤–µ—Ä—Ö, cooldown, restore scroll –ø–æ—Å–ª–µ prepend; –ø—Ä–∏ >200 —Å–æ–æ–±—â–µ–Ω–∏–π ‚Äî virtual list | MVP | DONE (–ø–æ–¥–≥—Ä—É–∑–∫–∞ + –¥–≤–æ–π–Ω–æ–π rAF; –ø—Ä–∏ >200 —Å–æ–æ–±—â–µ–Ω–∏–π ‚Äî react-virtuoso —Å firstItemIndex –∏ startReached) |
| –ò–Ω–ø—É—Ç —Å–æ–æ–±—â–µ–Ω–∏—è –∫–∞–∫ –≤ TG | Textarea —Å –∞–≤—Ç–æ-—É–≤–µ–ª–∏—á–µ–Ω–∏–µ–º –≤—ã—Å–æ—Ç—ã –ø–æ –º–µ—Ä–µ –≤–≤–æ–¥–∞ (min/max height) | MVP | DONE |
| –ß–µ—Ä–Ω–æ–≤–∏–∫–∏ —Å–æ–æ–±—â–µ–Ω–∏–π | –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ localStorage –ø—Ä–∏ —É—Ö–æ–¥–µ –∏–∑ —á–∞—Ç–∞; –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ –ø—Ä–∏ –æ—Ç–∫—Ä—ã—Ç–∏–∏; –æ—á–∏—Å—Ç–∫–∞ –ø—Ä–∏ –æ—Ç–ø—Ä–∞–≤–∫–µ (GramJS saveDraft ‚Äî –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ –ø–æ–∑–∂–µ) | MVP | DONE |
| –ü–∞–Ω–µ–ª–∏: —Å–∫—Ä—ã–≤–∞—à–∫–∞ –∏ –∫–Ω–æ–ø–∫–∏ | –ê–∫–∫–∞—É–Ω—Ç—ã: collapse —Ä—è–¥–æ–º —Å –∑–∞–≥–æ–ª–æ–≤–∫–æ–º, –ø–ª—é—Å —Ä—è–¥–æ–º —Å –ø–æ–∏—Å–∫–æ–º; –ß–∞—Ç—ã: —Ä–∞–∑–º–µ—Ä –∑–∞–≥–æ–ª–æ–≤–∫–∞ –∫–∞–∫ —É –∞–∫–∫–∞—É–Ω—Ç–æ–≤, —à–µ—Å—Ç–µ—Ä—ë–Ω–∫—É –∑–∞–º–µ–Ω–∏—Ç—å –∏–∫–æ–Ω–∫–æ–π —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ (RefreshCw) | MVP | DONE |

### 2.2 –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è (–ü–ö–ú)

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –ó–∞–¥–∞—á–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°—Ç–∞—Ç—É—Å |
|------------|--------|-----------|--------|
| –ù–∞–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º | –£–¥–∞–ª–∏—Ç—å, –†–µ–∞–∫—Ü–∏—è (–ª–∞–π–∫ –∏ —Ç.–¥.) | MVP | DONE (–£–¥–∞–ª–∏—Ç—å ‚Äî –ü–ö–ú; –†–µ–∞–∫—Ü–∏—è ‚Äî –ü–ö–ú, –≤—ã–±–æ—Ä —ç–º–æ–¥–∑–∏, PATCH reaction, –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º) |
| –ù–∞–¥ —á–∞—Ç–æ–º | –ó–∞–∫—Ä–µ–ø–∏—Ç—å, –£–¥–∞–ª–∏—Ç—å —á–∞—Ç, –î–æ–±–∞–≤–∏—Ç—å –≤ –ø–∞–ø–∫—É | MVP | DONE (–ü–ö–ú: –ó–∞–∫—Ä–µ–ø–∏—Ç—å/–û—Ç–∫—Ä–µ–ø–∏—Ç—å, –î–æ–±–∞–≤–∏—Ç—å –≤ –ø–∞–ø–∫—É, –£–¥–∞–ª–∏—Ç—å —á–∞—Ç ‚Äî —É–±—Ä–∞—Ç—å –∏–∑ —Å–ø–∏—Å–∫–∞ CRM, —Ç–æ–ª—å–∫–æ –≤–ª–∞–¥–µ–ª–µ—Ü; DELETE bd-accounts/:id/chats/:chatId) |
| –ù–∞–¥ –∞–∫–∫–∞—É–Ω—Ç–æ–º | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ (–ø–µ—Ä–µ—Ö–æ–¥ –≤ BD Accounts) | MVP | DONE (–ü–ö–ú –ø–æ –∞–∫–∫–∞—É–Ω—Ç—É ‚Üí ¬´–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞¬ª ‚Üí /dashboard/bd-accounts?accountId=‚Ä¶) |
| –ö–æ–º–ø–æ–Ω–µ–Ω—Ç | –ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π ContextMenu (–ø–æ–∑–∏—Ü–∏—è –ø–æ –∫–ª–∏–∫—É, –ø–æ–¥–º–µ–Ω—é) | MVP | DONE (components/ui/ContextMenu.tsx: ContextMenu, ContextMenuSection, ContextMenuItem; –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –¥–ª—è –ü–ö–ú —á–∞—Ç–∞, –∞–∫–∫–∞—É–Ω—Ç–∞, —Å–æ–æ–±—â–µ–Ω–∏—è) |

### 2.3 –°–æ–æ–±—â–µ–Ω–∏—è

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –ó–∞–¥–∞—á–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°—Ç–∞—Ç—É—Å |
|------------|--------|-----------|--------|
| –£–¥–∞–ª–µ–Ω–∏–µ | API DELETE message; –≤—ã–∑–æ–≤ GramJS client.deleteMessages; —Ñ—Ä–æ–Ω—Ç –ü–ö–ú ‚Üí —É–¥–∞–ª–∏—Ç—å, —É–±—Ä–∞—Ç—å –∏–∑ —Å–ø–∏—Å–∫–∞, –ø–æ–¥–ø–∏—Å–∫–∞ –Ω–∞ message.deleted; –±—ç–∫–µ–Ω–¥ ‚Äî UpdateDeleteMessages, UpdateDeleteChannelMessages, EditedMessage; bd-accounts POST delete-message, messaging-service DELETE /messages/:id | MVP | DONE |
| –†–µ–∞–∫—Ü–∏–∏/–ª–∞–π–∫–∏ | –ü–æ–ª–µ reactions –≤ –ë–î, PATCH API, –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º | v1 | DONE (–º–∏–≥—Ä–∞—Ü–∏—è messages.reactions JSONB; PATCH /api/messaging/messages/:id/reaction; –ü–ö–ú ¬´–†–µ–∞–∫—Ü–∏—è¬ª + –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º) |
| –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–æ—Ç–æ/–∞—É–¥–∏–æ/—Ñ–∞–π–ª–æ–≤ | base64 –≤ send (POST messaging/send –∏ bd-accounts/:id/send); –±—ç–∫–µ–Ω–¥ ‚Äî GramJS sendFile | MVP | DONE |
| –û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏–µ —Ç—è–∂—ë–ª—ã—Ö —Ñ–∞–π–ª–æ–≤ | –ü—Ä–æ–≤–µ—Ä–∫–∞ —Ä–∞–∑–º–µ—Ä–∞ –Ω–∞ –±—ç–∫–µ (2 GB), 413 + —Å–æ–æ–±—â–µ–Ω–∏–µ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ | MVP | DONE |

### 2.4 –ü–∞–ø–∫–∏ –∏ —á–∞—Ç—ã

**–ü–æ–¥—Ä–æ–±–Ω–µ–µ:** —Å–º. **docs/UX_MESSAGING_ARCHITECTURE.md** (—Ä–∞–∑–¥–µ–ª 1).

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –ó–∞–¥–∞—á–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°—Ç–∞—Ç—É—Å |
|------------|--------|-----------|--------|
| –ü–∞–ø–∫–∏ –∏–∑ —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏–∏ + –≤—Ä—É—á–Ω—É—é | bd_account_sync_folders + is_user_created; —Å—Ö–µ–º–∞ –∏ —à–∞–≥–∏ –≤ UX_MESSAGING_ARCHITECTURE | MVP | DONE (–º–∏–≥—Ä–∞—Ü–∏—è is_user_created, GET/POST –≤–æ–∑–≤—Ä–∞—â–∞—é—Ç) |
| –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –ø–∞–ø–æ–∫ –≤ –±–æ–∫–æ–≤–æ–π –ø–∞–Ω–µ–ª–∏ | –°–ø–∏—Å–æ–∫ –ø–∞–ø–æ–∫, –≤—ã–±–æ—Ä —Ñ–∏–ª—å—Ç—Ä–∞, –ø–æ–¥–ø–∏—Å—å –∏—Å—Ç–æ—á–Ω–∏–∫–∞ (Telegram/CRM) | MVP | DONE (–ø–∞–Ω–µ–ª—å —á–∞—Ç–æ–≤: ¬´–ü–∞–ø–∫–∞: –í—Å–µ¬ª + –∫–Ω–æ–ø–∫–∏ –ø–∞–ø–æ–∫ —Å TG/CRM) |
| –î–æ–±–∞–≤–∏—Ç—å —á–∞—Ç –≤ –ø–∞–ø–∫—É | –ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é ¬´–î–æ–±–∞–≤–∏—Ç—å –≤ –ø–∞–ø–∫—É¬ª ‚Üí —Å–ø–∏—Å–æ–∫ –ø–∞–ø–æ–∫, PATCH chat folder | MVP | DONE (–ü–ö–ú –ø–æ —á–∞—Ç—É ‚Üí Add to folder ‚Üí –ø–∞–ø–∫–∏ + ¬´–ë–µ–∑ –ø–∞–ø–∫–∏¬ª, PATCH /api/bd-accounts/:id/chats/:chatId/folder) |
| –û–±—Ä–∞—Ç–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –≤ TG | –ó–∞–≥–ª—É—à–∫–∞ (–∫–Ω–æ–ø–∫–∞/–ø—É–Ω–∫—Ç, disabled –∏–ª–∏ alert) | v1 | DONE (–∫–Ω–æ–ø–∫–∞ ¬´–°–∏–Ω—Ö—Ä. —Å TG¬ª –≤ –±–ª–æ–∫–µ –ø–∞–ø–æ–∫, alert ¬´–°–∫–æ—Ä–æ¬ª) |

### 2.5 –ü—Ä–æ–∏–∑–≤–æ–¥–∏—Ç–µ–ª—å–Ω–æ—Å—Ç—å

**–ü–æ–¥—Ä–æ–±–Ω–µ–µ:** —Å–º. **docs/UX_MESSAGING_ARCHITECTURE.md** (—Ä–∞–∑–¥–µ–ª 2). –í–∞—Ä–∏–∞–Ω—Ç—ã: LRU –≤ –ø–∞–º—è—Ç–∏, Cache API; –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ ‚Äî –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ (react-virtuoso).

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –ó–∞–¥–∞—á–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°—Ç–∞—Ç—É—Å |
|------------|--------|-----------|--------|
| –ö—ç—à –∏–∫–æ–Ω–æ–∫/–∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏–π | LRU –ø–æ –∫–ª—é—á—É (account/chat/media), revoke –ø—Ä–∏ evict; —Å–º. –¥–æ–∫—É | MVP | DONE (lib/cache/blob-url-cache.ts, BDAccountAvatar, ChatAvatar, useMediaUrl) |
| Lazy loading –∏—Å—Ç–æ—Ä–∏–∏ | –ü–æ–¥–≥—Ä—É–∑–∫–∞ –≤–≤–µ—Ä—Ö; –ø—Ä–∏ >200 —Å–æ–æ–±—â–µ–Ω–∏–π ‚Äî virtual list –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º | MVP | DONE (react-virtuoso –ø—Ä–∏ >200 —Å–æ–æ–±—â–µ–Ω–∏–π, firstItemIndex –¥–ª—è prepend) |

### 2.6 Workspace

**–ü–æ–¥—Ä–æ–±–Ω–µ–µ:** —Å–º. **docs/UX_MESSAGING_ARCHITECTURE.md** (—Ä–∞–∑–¥–µ–ª 3). –°–æ—Å—Ç–æ—è–Ω–∏—è invited/accepted/declined, –∑–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–µ–π, –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –∞–∫—Ç–∏–≤–Ω–æ–≥–æ workspace.

| –¢—Ä–µ–±–æ–≤–∞–Ω–∏–µ | –ó–∞–¥–∞—á–∞ | –ü—Ä–∏–æ—Ä–∏—Ç–µ—Ç | –°—Ç–∞—Ç—É—Å |
|------------|--------|-----------|--------|
| –ò–Ω–≤–∞–π—Ç—ã: invited/accepted/declined | organization_invite_links; —Å—Ç—Ä–∞–Ω–∏—Ü–∞ /invite/[token]; accept API | v1 | DONE (–º–∏–≥—Ä–∞—Ü–∏–∏; GET invite –ø—É–±–ª–∏—á–Ω–æ; /invite/[token] –¥–ª—è –≥–æ—Å—Ç—è –∏ –∑–∞–ª–æ–≥–∏–Ω–µ–Ω–Ω–æ–≥–æ; accept ‚Üí fetchWorkspaces + switchWorkspace; GET/DELETE invite-links; UI —Å–ø–∏—Å–æ–∫/–æ—Ç–∑—ã–≤ –Ω–∞ Team) |
| –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–µ–π | –ü—Ä–æ–≤–µ—Ä–∫–∞ email/user –≤ org –∏ –≤ –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏—è—Ö | v1 | –ß–∞—Å—Ç–∏—á–Ω–æ (–ø—Ä–∏ accept –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ organization_members) |
| –ü–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞ | –°–ø–∏—Å–æ–∫ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–π, —Å–º–µ–Ω–∞ active ‚Üí –Ω–æ–≤—ã–π JWT; —Å–º. –¥–æ–∫—É | v1 | DONE (GET /api/auth/workspaces, POST switch-workspace, dropdown –≤ —Å–∞–π–¥–±–∞—Ä–µ) |
| –ú—É–ª—å—Ç–∏-–≤–æ—Ä–∫—Å–ø–µ–π—Å –≤ –ë–î | organization_members, –º–∏–≥—Ä–∞—Ü–∏—è; accept = add member | v1 | DONE (–º–∏–≥—Ä–∞—Ü–∏—è organization_members, –∑–∞–ø–æ–ª–Ω–µ–Ω–∏–µ –∏–∑ users) |

### 2.7 Telegram-like Messaging (—Å–≤–æ–¥)

| –≠–ª–µ–º–µ–Ω—Ç | –ó–∞–¥–∞—á–∞ | –°—Ç–∞—Ç—É—Å |
|---------|--------|--------|
| –°–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ + –∞–∫—Ç–∏–≤–Ω—ã–π —á–∞—Ç | –£–∂–µ –µ—Å—Ç—å | OK |
| Message bubbles, hover/active | –°—Ç–∏–ª–∏ –¥–æ—Ä–∞–±–æ—Ç–∞—Ç—å –ø–æ–¥ TG | DONE (hover/active –≤ globals.css) |
| Instant scroll | scrollToBottom + –∑–∞–¥–µ—Ä–∂–∫–∏ –ø–æ—Å–ª–µ –º–µ–¥–∏–∞ | DONE (50/150/450 ms) |
| Lazy loading | –ï—Å—Ç—å; –æ–ø—Ç–∏–º–∏–∑–∞—Ü–∏—è –±–µ–∑ —Ñ—Ä–∏–∑–æ–≤ | DONE (Virtuoso –ø—Ä–∏ >200) |
| Unread counters | –ü–æ –ø–∞–ø–∫–∞–º/—á–∞—Ç–∞–º | DONE (–±–µ–π–¥–∂–∏ –Ω–∞ –∫–Ω–æ–ø–∫–∞—Ö –ø–∞–ø–æ–∫ –∏ ¬´–í—Å–µ¬ª) |
| Pinned chats | –¢–∞–±–ª–∏—Ü–∞ user_chat_pins, API, —Å–µ–∫—Ü–∏—è ¬´–ó–∞–∫—Ä–µ–ø–ª—ë–Ω–Ω—ã–µ¬ª | DONE |
| –ú—É–ª—å—Ç–∏-–∞–∫–∫–∞—É–Ω—Ç—ã, –∏–Ω–¥–∏–∫–∞—Ç–æ—Ä | –ì—Ä—É–ø–ø–∏—Ä–æ–≤–∫–∞ –ø–æ –∞–∫–∫–∞—É–Ω—Ç—É –≤ —Å–∞–π–¥–±–∞—Ä–µ | OK |
| –ü–∞–ø–∫–∏, –ø–æ—Ä—è–¥–æ–∫, –∏—Å—Ç–æ—á–Ω–∏–∫ | sync_folders + is_user_created, UI | DONE |

### 2.8 Multi-Workspace System (—Å–≤–æ–¥)

| –≠–ª–µ–º–µ–Ω—Ç | –ó–∞–¥–∞—á–∞ | –°—Ç–∞—Ç—É—Å |
|---------|--------|--------|
| –°–æ–∑–¥–∞–Ω–∏–µ/—É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞–º–∏ | –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞, –ø–µ—Ä–µ–¥–∞—á–∞ –≤–ª–∞–¥–µ–Ω–∏—è | DONE (GET/PATCH organization, —Ç–æ–ª—å–∫–æ owner/admin; —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å slug; POST transfer-ownership; –≤–∫–ª–∞–¥–∫–∞ ¬´–†–∞–±–æ—á–µ–µ –ø—Ä–æ—Å—Ç—Ä–∞–Ω—Å—Ç–≤–æ¬ª + –±–ª–æ–∫ ¬´–ü–µ—Ä–µ–¥–∞—Ç—å –≤–ª–∞–¥–µ–Ω–∏–µ¬ª –¥–ª—è owner) |
| Invite-links | organization_invite_links, —Å—Ç—Ä–∞–Ω–∏—Ü–∞ invite, accept –¥–ª—è new/existing user | DONE (POST/GET/DELETE invite-links, UI –Ω–∞ Team; /invite/[token]; signup —Å ?invite=; accept ‚Üí switch workspace) |
| –†–æ–ª–∏ Owner..Viewer | –£–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è –≤ –ë–î –∏ API; –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ —Å–º–µ–Ω–∞ –Ω–∞ Team | DONE (owner/admin/supervisor/bidi/viewer, –º–∏–≥—Ä–∞—Ü–∏—è member‚Üíbidi; —Ç–æ–ª—å–∫–æ owner/admin –º–æ–≥—É—Ç –º–µ–Ω—è—Ç—å —Ä–æ–ª–∏; dropdown –Ω–∞ Team) |
| Granular permissions | role_permissions (–º–∏–≥—Ä–∞—Ü–∏—è), canPermission, –ø—Ä–æ–≤–µ—Ä–∫–∏ –≤ auth/team | DONE |
| –°—Ç—Ä–∞–Ω–∏—Ü–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è | –£—á–∞—Å—Ç–Ω–∏–∫–∏, —Ä–æ–ª–∏, –∏–Ω–≤–∞–π—Ç—ã, –æ—Ç–∑—ã–≤ | DONE (Team: —É—á–∞—Å—Ç–Ω–∏–∫–∏, —Å–º–µ–Ω–∞ —Ä–æ–ª–∏, –∏–Ω–≤–∞–π—Ç –ø–æ email –∏ –ø–æ —Å—Å—ã–ª–∫–µ, —Å–ø–∏—Å–æ–∫/–æ—Ç–∑—ã–≤ —Å—Å—ã–ª–æ–∫, —Å–ø–∏—Å–æ–∫/–æ—Ç–∑—ã–≤ –æ–∂–∏–¥–∞—é—â–∏—Ö –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–π –ø–æ email) |

### 2.9 –ü–∞–ø–∫–∏ –≤–Ω—É—Ç—Ä–∏ CRM (–µ–¥–∏–Ω—ã–π –¥–∏–∞–ª–æ–≥)

| –≠–ª–µ–º–µ–Ω—Ç | –ó–∞–¥–∞—á–∞ | –°—Ç–∞—Ç—É—Å |
|---------|--------|--------|
| –ï–¥–∏–Ω—ã–π –¥–∏–∞–ª–æ–≥ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è | –ú–æ–¥–∞–ª–∫–∞: —Å–ø–∏—Å–æ–∫ –ø–∞–ø–æ–∫, drag&drop –ø–æ—Ä—è–¥–∫–∞, –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –ø–∞–ø–∫–∏ (–Ω–∞–∑–≤–∞–Ω–∏–µ ‚â§12, –∏–∫–æ–Ω–∫–∞) | DONE (FolderManageModal, POST custom, PATCH order, –≤–µ—Ä—Ç–∏–∫–∞–ª—å–Ω–∞—è –ø–æ–ª–æ—Å–∫–∞ + Edit) |
| –ò–∫–æ–Ω–∫–∏ –ø–∞–ø–æ–∫ | –ü–æ–ª–µ icon (emoji/–∫–ª—é—á), –≤—ã–±–æ—Ä –≤ UI | DONE (–º–∏–≥—Ä–∞—Ü–∏—è icon –≤ sync_folders, GET/POST/PATCH, –≤—ã–±–æ—Ä emoji –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–µ –∏ –≤ –¥–∏–∞–ª–æ–≥–µ –ø–∞–ø–æ–∫) |
| –í–ª–∏—è–Ω–∏–µ –Ω–∞ —á–∞—Ç—ã/–Ω–∞–≤–∏–≥–∞—Ü–∏—é/—Ñ–∏–ª—å—Ç—Ä–∞—Ü–∏—é | –£–∂–µ: —Ñ–∏–ª—å—Ç—Ä –ø–æ –ø–∞–ø–∫–µ, —Å–ø–∏—Å–æ–∫ —á–∞—Ç–æ–≤ –ø–æ folder_id | OK |

---

## –ß–∞—Å—Ç—å 3. –ü–æ—Ä—è–¥–æ–∫ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

### –§–∞–∑–∞ 1 (MVP) ‚Äî UX –∏ –±–∞–∑–æ–≤—ã–π Telegram-like

1. **–ó–≤—É–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:** store (zustand) + localStorage, –∫–Ω–æ–ø–∫–∞ –≤ —à–∞–ø–∫–µ/–Ω–∞—Å—Ç—Ä–æ–π–∫–∞—Ö, –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ WebSocket –ø–µ—Ä–µ–¥ –≤–æ—Å–ø—Ä–æ–∏–∑–≤–µ–¥–µ–Ω–∏–µ–º.
2. **–°—Ç–∏–ª—å Telegram:** CSS (–ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ, –æ—Ç—Å—Ç—É–ø—ã, —Å–∫—Ä—É–≥–ª–µ–Ω–∏—è), –≥–∞–ª–æ—á–∫–∏ –ø–æ status.
3. **LinkifyText:** –∫–æ–º–ø–æ–Ω–µ–Ω—Ç, –ø–∞—Ä—Å–∏–Ω–≥ URL –≤ —Ç–µ–∫—Å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è.
4. **–ú–µ–¥–∏–∞ overlay:** –∫–æ–º–ø–æ–Ω–µ–Ω—Ç MediaViewer, –æ—Ç–∫—Ä—ã—Ç–∏–µ —Ñ–æ—Ç–æ/–≤–∏–¥–µ–æ –ø–æ –∫–ª–∏–∫—É –ø–æ–≤–µ—Ä—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞; –ø—Ä–µ–≤—å—é –∏ ¬´–ó–∞–≥—Ä—É–∑–∏—Ç—å¬ª –¥–ª—è —Ç—è–∂—ë–ª—ã—Ö.
5. **AI-–ø–∞–Ω–µ–ª—å:** –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∏–∑–∏—Ç–µ (localStorage –∫–ª—é—á).
6. **–°–∫—Ä–æ–ª–ª –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É:** scrollToBottom –ø—Ä–∏ —Å–º–µ–Ω–µ —á–∞—Ç–∞ + —Ç–∞–π–º–∞—É—Ç—ã 150/450 ms; min-height –¥–ª—è –º–µ–¥–∏–∞-–±–ª–æ–∫–æ–≤.
7. **–ö–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é:** –∫–æ–º–ø–æ–Ω–µ–Ω—Ç ContextMenu; –¥–µ–π—Å—Ç–≤–∏—è –¥–ª—è —Å–æ–æ–±—â–µ–Ω–∏—è (—É–¥–∞–ª–∏—Ç—å, —Ä–µ–∞–∫—Ü–∏—è), —á–∞—Ç–∞ (–∑–∞–∫—Ä–µ–ø–∏—Ç—å, —É–¥–∞–ª–∏—Ç—å, –≤ –ø–∞–ø–∫—É), –∞–∫–∫–∞—É–Ω—Ç–∞ (–Ω–∞—Å—Ç—Ä–æ–π–∫–∏).
8. **–ü–∞–ø–∫–∏ –≤ UI:** –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø–∞–ø–æ–∫, –∏—Å—Ç–æ—á–Ω–∏–∫ (Telegram/CRM), ¬´–î–æ–±–∞–≤–∏—Ç—å –≤ –ø–∞–ø–∫—É¬ª –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–º –º–µ–Ω—é; API PATCH folder –¥–ª—è —á–∞—Ç–∞.
9. **–£–¥–∞–ª–µ–Ω–∏–µ —Å–æ–æ–±—â–µ–Ω–∏–π:** API DELETE –≤ messaging-service + –≤—ã–∑–æ–≤ delete –≤ GramJS; —Ñ—Ä–æ–Ω—Ç –æ–±–Ω–æ–≤–ª—è–µ—Ç —Å–ø–∏—Å–æ–∫.
10. **–ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤/—Ñ–æ—Ç–æ/–∞—É–¥–∏–æ:** —Ä–∞—Å—à–∏—Ä–µ–Ω–∏–µ send API, –ª–∏–º–∏—Ç —Ä–∞–∑–º–µ—Ä–∞, –æ—à–∏–±–∫–∞ –Ω–∞ —Ñ—Ä–æ–Ω—Ç–µ.
11. **–ö—ç—à blob:** LRU –¥–ª—è –∞–≤–∞—Ç–∞—Ä–æ–∫ –∏ –º–µ–¥–∏–∞ (—Ö—É–∫ –∏–ª–∏ –º–æ–¥—É–ª—å).
12. **Pinned chats:** —Ç–∞–±–ª–∏—Ü–∞ user_chat_pins, API GET/POST/DELETE, —Å–µ–∫—Ü–∏—è ¬´–ó–∞–∫—Ä–µ–ø–ª—ë–Ω–Ω—ã–µ¬ª –∏ –ø—É–Ω–∫—Ç—ã Pin/Unpin –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–º –º–µ–Ω—é.

### –§–∞–∑–∞ 2 (v1) ‚Äî Workspace –∏ —Ä–æ–ª–∏

13. **organization_invite_links:** –º–∏–≥—Ä–∞—Ü–∏—è, API —Å–æ–∑–¥–∞–Ω–∏–µ/—Å–ø–∏—Å–æ–∫/–æ—Ç–∑—ã–≤, verify (public), accept (auth).
14. **–°—Ç—Ä–∞–Ω–∏—Ü–∞ /invite/[token]:** –¥–ª—è –Ω–µ–∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö (signup —Å token) –∏ –∑–∞—Ä–µ–≥–∏—Å—Ç—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö (accept + redirect).
15. **organization_members:** –º–∏–≥—Ä–∞—Ü–∏—è; accept = –¥–æ–±–∞–≤–ª–µ–Ω–∏–µ –≤ org –±–µ–∑ —Å–º–µ–Ω—ã —Ç–µ–∫—É—â–µ–π; —Å–ø–∏—Å–æ–∫ –≤–æ—Ä–∫—Å–ø–µ–π—Å–æ–≤ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è.
16. **Switch workspace:** API —Å–º–µ–Ω—ã –∞–∫—Ç–∏–≤–Ω–æ–π org (–Ω–æ–≤—ã–π JWT –∏–ª–∏ –∑–∞–≥–æ–ª–æ–≤–æ–∫); –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤ —à–∞–ø–∫–µ.
17. **–†–æ–ª–∏:** —É–Ω–∏—Ñ–∏–∫–∞—Ü–∏—è Owner/Admin/Manager/Agent/Viewer; –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏ —Å–º–µ–Ω–∞ —Ä–æ–ª–µ–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ Team. ‚Äî DONE (—Ä–æ–ª–∏ owner/admin/supervisor/bidi/viewer, —Ç–æ–ª—å–∫–æ owner/admin –º–æ–≥—É—Ç –º–µ–Ω—è—Ç—å, dropdown –Ω–∞ Team).
18. **–†–µ–∞–∫—Ü–∏–∏ —Å–æ–æ–±—â–µ–Ω–∏–π:** –ø–æ–ª–µ –≤ –ë–î, PATCH API, –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –≤ —á–∞—Ç–µ. ‚Äî DONE.
19. **–ò–∫–æ–Ω–∫–∏ –ø–∞–ø–æ–∫:** –ø–æ–ª–µ icon, UI –≤—ã–±–æ—Ä–∞ emoji. ‚Äî DONE (sync_folders.icon, PATCH sync-folders/:folderId, –≤—ã–±–æ—Ä emoji –≤ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–µ).
20. **–û–±—Ä–∞—Ç–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–∞–ø–æ–∫ –≤ TG:** –∫–Ω–æ–ø–∫–∞ ¬´–°–∏–Ω—Ö—Ä. —Å TG¬ª, POST push-to-telegram, –ø–∞–ø–∫–∏ 0/1 –Ω–µ —Ç—Ä–æ–≥–∞–µ–º, —Å–æ–∑–¥–∞–Ω–∏–µ —Ñ–∏–ª—å—Ç—Ä–æ–≤ –≤ TG –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏. ‚Äî DONE.

### –§–∞–∑–∞ 3 (v2) ‚Äî AI, –æ–º–Ω–∏–∫–∞–Ω–∞–ª, polish

21. **Audit logs:** —Ç–∞–±–ª–∏—Ü–∞ audit_logs, –∑–∞–ø–∏—Å—å –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏—Ö –¥–µ–π—Å—Ç–≤–∏–π (organization.updated, ownership_transferred, team.member_role_changed, invitation_revoked), GET /api/auth/audit-logs, –≤–∫–ª–∞–¥–∫–∞ ¬´–ñ—É—Ä–Ω–∞–ª –∞—É–¥–∏—Ç–∞¬ª –≤ –ù–∞—Å—Ç—Ä–æ–π–∫–∞—Ö (owner/admin). ‚Äî DONE.
22. **–ì—Ä–∞–Ω—É–ª—è—Ä–Ω—ã–µ permissions:** —Ç–∞–±–ª–∏—Ü–∞ role_permissions (role, resource, action), –¥–µ—Ñ–æ–ª—Ç—ã –ø–æ —Ä–æ–ª—è–º; canPermission() –≤ auth –∏ team; –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è workspace.update, audit.read, team.update, invitations.delete. ‚Äî DONE.
23. **AI summarize –≤ —á–∞—Ç–µ:** API –∏ –≤–∏–¥–∂–µ—Ç.
24. **Auto-create deal/lead –∏–∑ —á–∞—Ç–∞:** –ø—Ä–∞–≤–∏–ª–∞ –∏–ª–∏ AI.
25. **Unified Inbox:** –º–æ–¥–µ–ª—å channels/conversations, –æ–¥–∏–Ω timeline –ø–æ –∫–æ–Ω—Ç–∞–∫—Ç—É.
26. **Command palette (‚åòK):** –ø–æ–∏—Å–∫ –∏ –±—ã—Å—Ç—Ä—ã–µ –ø–µ—Ä–µ—Ö–æ–¥—ã.
27. **Onboarding –∏ empty states:** —à–∞–≥–∏ –¥–ª—è –Ω–æ–≤—ã—Ö –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª–µ–π, –ø–æ–¥—Å–∫–∞–∑–∫–∏.

---

## –ß–∞—Å—Ç—å 4. Data models (–∫–ª—é—á–µ–≤—ã–µ –∏–∑–º–µ–Ω–µ–Ω–∏—è)

- **user_chat_pins:** user_id, organization_id, bd_account_id, channel_id, order_index.
- **bd_account_sync_folders:** –¥–æ–±–∞–≤–∏—Ç—å icon (VARCHAR), is_user_created (boolean) –µ—Å–ª–∏ –µ—â—ë –Ω–µ—Ç.
- **organization_invite_links:** organization_id, token, role, expires_at, created_by.
- **organization_members:** organization_id, user_id, role, invited_by, joined_at, status (–¥–ª—è –º—É–ª—å—Ç–∏-–≤–æ—Ä–∫—Å–ø–µ–π—Å–∞).
- **messages:** –ø–æ–¥–¥–µ—Ä–∂–∫–∞ reactions (JSONB –∏–ª–∏ –æ—Ç–¥–µ–ª—å–Ω–∞—è —Ç–∞–±–ª–∏—Ü–∞); —Å—Ç–∞—Ç—É—Å—ã sent/delivered/read –¥–ª—è –≥–∞–ª–æ—á–µ–∫.
- **audit_logs:** organization_id, user_id, action, resource_type, resource_id, old_value, new_value, ip, created_at.

---

## –ß–∞—Å—Ç—å 5. –ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ (–∏—Ç–æ–≥)

### –§–∞–∑–∞ 1 (—Å–¥–µ–ª–∞–Ω–æ)

- **–ó–≤—É–∫ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏–π:** store notifications-store, –∫–Ω–æ–ø–∫–∞ mute/unmute –≤ —à–∞–ø–∫–µ, –ø—Ä–æ–≤–µ—Ä–∫–∞ –≤ WebSocket –ø–µ—Ä–µ–¥ play, —Å–æ—Å—Ç–æ—è–Ω–∏–µ –≤ localStorage.
- **–°—Ç–∏–ª—å Telegram:** –∫–ª–∞—Å—Å—ã msg-bubble-out / msg-bubble-in –≤ globals.css, –≥–∞–ª–æ—á–∫–∏ Check/CheckCheck –ø–æ status.
- **–°—Å—ã–ª–∫–∏ –≤ —á–∞—Ç–µ:** –∫–æ–º–ø–æ–Ω–µ–Ω—Ç LinkifyText.
- **–§–æ—Ç–æ/–≤–∏–¥–µ–æ –ø–æ–≤–µ—Ä—Ö –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞:** MediaViewer, min-height –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã, –∫–Ω–æ–ø–∫–∞ ¬´–û—Ç–∫—Ä—ã—Ç—å –Ω–∞ –≤–µ—Å—å —ç–∫—Ä–∞–Ω¬ª –¥–ª—è –≤–∏–¥–µ–æ.
- **AI-–ø–∞–Ω–µ–ª—å:** –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é —Ä–∞–∑–≤—ë—Ä–Ω—É—Ç–∞ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º –≤–∏–∑–∏—Ç–µ (localStorage !== 'false').
- **–°–∫—Ä–æ–ª–ª –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É:** scrollToBottom –ø—Ä–∏ —Å–º–µ–Ω–µ —á–∞—Ç–∞ –∏ —Å–æ–æ–±—â–µ–Ω–∏–π + —Ç–∞–π–º–∞—É—Ç—ã 150/450 ms.
- **–ü–∞–ø–∫–∏ –≤ UI:** –º–∏–≥—Ä–∞—Ü–∏—è `is_user_created` –≤ bd_account_sync_folders; GET sync-folders –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç is_user_created; GET messaging/chats –≤–æ–∑–≤—Ä–∞—â–∞–µ—Ç folder_id; PATCH bd-accounts/:id/chats/:chatId/folder; –≤ –ø–∞–Ω–µ–ª–∏ —á–∞—Ç–æ–≤ ‚Äî —Ñ–∏–ª—å—Ç—Ä ¬´–ü–∞–ø–∫–∞: –í—Å–µ¬ª + –∫–Ω–æ–ø–∫–∏ –ø–∞–ø–æ–∫ (TG/CRM); –ü–ö–ú –ø–æ —á–∞—Ç—É ‚Äî ¬´–î–æ–±–∞–≤–∏—Ç—å –≤ –ø–∞–ø–∫—É¬ª ‚Üí –≤—ã–±–æ—Ä –ø–∞–ø–∫–∏ –∏–ª–∏ ¬´–ë–µ–∑ –ø–∞–ø–∫–∏¬ª.
- **–ö—ç—à blob (LRU):** –º–æ–¥—É–ª—å `lib/cache/blob-url-cache.ts` (get/set, max 200, revoke –ø—Ä–∏ evict); –∫–ª—é—á–∏ avatar:account:id, avatar:chat:bdAccountId:chatId, media:url; –ø–æ–¥–∫–ª—é—á—ë–Ω –≤ BDAccountAvatar, ChatAvatar, useMediaUrl.
- **Pinned chats:** –º–∏–≥—Ä–∞—Ü–∏—è user_chat_pins (user_id, organization_id, bd_account_id, channel_id, order_index); messaging-service: GET/POST/DELETE /api/messaging/pinned-chats; —Ñ—Ä–æ–Ω—Ç: –∑–∞–≥—Ä—É–∑–∫–∞ pins –ø—Ä–∏ –≤—ã–±–æ—Ä–µ –∞–∫–∫–∞—É–Ω—Ç–∞, —Å–µ–∫—Ü–∏–∏ ¬´–ó–∞–∫—Ä–µ–ø–ª—ë–Ω–Ω—ã–µ¬ª –∏ ¬´–ß–∞—Ç—ã¬ª, Pin/Unpin –≤ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–º –º–µ–Ω—é —á–∞—Ç–∞.
- **–û—Ç–ø—Ä–∞–≤–∫–∞ —Ñ–∞–π–ª–æ–≤ –≤ —á–∞—Ç:** –æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ fileBase64/fileName –≤ POST messaging/send –∏ bd-accounts/:id/send; –ª–∏–º–∏—Ç 2 GB –Ω–∞ –±—ç–∫–µ, –æ—Ç–≤–µ—Ç 413 –ø—Ä–∏ –ø—Ä–µ–≤—ã—à–µ–Ω–∏–∏; —Ñ—Ä–æ–Ω—Ç ‚Äî –≤—ã–±–æ—Ä —Ñ–∞–π–ª–∞ (—Å–∫—Ä–µ–ø–∫–∞), –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –∏–º–µ–Ω–∏ –∏ —Å–±—Ä–æ—Å, –æ—Ç–ø—Ä–∞–≤–∫–∞ base64, —Å–æ–æ–±—â–µ–Ω–∏–µ ¬´–§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π. –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π —Ä–∞–∑–º–µ—Ä 2 –ì–ë¬ª –ø—Ä–∏ 413.
- **–ü–ö–ú –ø–æ –∞–∫–∫–∞—É–Ω—Ç—É:** –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–µ –º–µ–Ω—é –ø–æ –ø—Ä–∞–≤–æ–º—É –∫–ª–∏–∫—É –Ω–∞ –∞–∫–∫–∞—É–Ω—Ç–µ –≤ –ø–∞–Ω–µ–ª–∏ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ ‚Äî –ø—É–Ω–∫—Ç ¬´–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –∞–∫–∫–∞—É–Ω—Ç–∞¬ª —Å –ø–µ—Ä–µ—Ö–æ–¥–æ–º –Ω–∞ `/dashboard/bd-accounts?accountId=‚Ä¶`.
- **–ü–ö–ú –ø–æ —á–∞—Ç—É ‚Äî ¬´–£–¥–∞–ª–∏—Ç—å —á–∞—Ç¬ª:** –ø—É–Ω–∫—Ç ¬´–£–¥–∞–ª–∏—Ç—å —á–∞—Ç¬ª (—Ç–æ–ª—å–∫–æ –¥–ª—è –≤–ª–∞–¥–µ–ª—å—Ü–∞ –∞–∫–∫–∞—É–Ω—Ç–∞); –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ; DELETE `/api/bd-accounts/:id/chats/:chatId` (—É–¥–∞–ª–µ–Ω–∏–µ –∏–∑ bd_account_sync_chats); —á–∞—Ç –∏—Å—á–µ–∑–∞–µ—Ç –∏–∑ —Å–ø–∏—Å–∫–∞, –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ —Å–Ω–∏–º–∞–µ—Ç—Å—è –≤—ã–±–æ—Ä —á–∞—Ç–∞.
- **–†–µ–∞–∫—Ü–∏–∏ –Ω–∞ —Å–æ–æ–±—â–µ–Ω–∏—è (v1):** –º–∏–≥—Ä–∞—Ü–∏—è `messages.reactions` (JSONB); PATCH `/api/messaging/messages/:id/reaction` (body `{ emoji }`); –≤ –ü–ö–ú –ø–æ —Å–æ–æ–±—â–µ–Ω–∏—é ‚Äî –±–ª–æ–∫ ¬´–†–µ–∞–∫—Ü–∏—è¬ª —Å —ç–º–æ–¥–∑–∏ (üëç ‚ù§Ô∏è üî• –∏ —Ç.–¥.); –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ —Ä–µ–∞–∫—Ü–∏–π –ø–æ–¥ —Å–æ–æ–±—â–µ–Ω–∏–µ–º (emoji + —Å—á—ë—Ç—á–∏–∫).
- **–ü–æ–¥–≥—Ä—É–∑–∫–∞ –∏—Å—Ç–æ—Ä–∏–∏ –±–µ–∑ —Ñ—Ä–∏–∑–æ–≤:** –≤–æ—Å—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–∏–µ —Å–∫—Ä–æ–ª–ª–∞ –ø–æ—Å–ª–µ prepend ‚Äî –¥–≤–æ–π–Ω–æ–π requestAnimationFrame –¥–ª—è –ø—Ä–∏–º–µ–Ω–µ–Ω–∏—è scrollTop –ø–æ—Å–ª–µ –æ—Ç—Ä–∏—Å–æ–≤–∫–∏; cooldown 2.5 —Å —Å–æ—Ö—Ä–∞–Ω—ë–Ω; –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ ‚Äî –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏ –ø–æ –º–µ—Ç—Ä–∏–∫–∞–º.
- **–û–±—Ä–∞—Ç–Ω–∞—è —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è –ø–∞–ø–æ–∫ –≤ TG:** –∫–Ω–æ–ø–∫–∞ ¬´–°–∏–Ω—Ö—Ä. —Å TG¬ª –≤ –±–ª–æ–∫–µ –ø–∞–ø–æ–∫; POST sync-folders-push-to-telegram; telegram-manager.pushFoldersToTelegram (–ø–∞–ø–∫–∏ 0/1 –Ω–µ —Ç—Ä–æ–≥–∞–µ–º; folder_id >= 2, UpdateDialogFilter —Å–æ–∑–¥–∞—ë—Ç —Ñ–∏–ª—å—Ç—Ä –≤ TG –ø—Ä–∏ –æ—Ç—Å—É—Ç—Å—Ç–≤–∏–∏).
- **–ü–µ—Ä–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π ContextMenu:** –∫–æ–º–ø–æ–Ω–µ–Ω—Ç `frontend/components/ui/ContextMenu.tsx` ‚Äî `ContextMenu` (open, onClose, x, y), `ContextMenuSection` (label, noTopBorder), `ContextMenuItem` (label, onClick, icon, destructive, disabled); —Å—Ç—Ä–∞–Ω–∏—Ü–∞ –º–µ—Å—Å–µ–Ω–¥–∂–µ—Ä–∞ –ø–µ—Ä–µ–≤–µ–¥–µ–Ω–∞ –Ω–∞ –Ω–µ–≥–æ –¥–ª—è –ü–ö–ú –ø–æ —á–∞—Ç—É, –∞–∫–∫–∞—É–Ω—Ç—É –∏ —Å–æ–æ–±—â–µ–Ω–∏—é.
- **–°—Ç–∏–ª–∏ message bubbles:** –≤ globals.css –¥–æ–±–∞–≤–ª–µ–Ω—ã hover/active –¥–ª—è .msg-bubble-out –∏ .msg-bubble-in (–∫–∞–∫ –≤ TG).
- **Instant scroll:** –¥–æ–±–∞–≤–ª–µ–Ω–∞ –∑–∞–¥–µ—Ä–∂–∫–∞ 50 ms –≤ –¥–æ–ø–æ–ª–Ω–µ–Ω–∏–µ –∫ 150/450 ms –¥–ª—è scrollToBottom –ø—Ä–∏ —Å–º–µ–Ω–µ —á–∞—Ç–∞/—Å–æ–æ–±—â–µ–Ω–∏–π.
- **Unread –ø–æ –ø–∞–ø–∫–∞–º:** —Å—á—ë—Ç—á–∏–∫–∏ –Ω–µ–ø—Ä–æ—á–∏—Ç–∞–Ω–Ω—ã—Ö –Ω–∞ –∫–Ω–æ–ø–∫–∞—Ö ¬´–í—Å–µ¬ª –∏ –Ω–∞ –∫–∞–∂–¥–æ–π –ø–∞–ø–∫–µ –≤ –ø–∞–Ω–µ–ª–∏ —á–∞—Ç–æ–≤ (unreadByFolder).
- **–í–∏—Ä—Ç—É–∞–ª—å–Ω—ã–π —Å–ø–∏—Å–æ–∫ —Å–æ–æ–±—â–µ–Ω–∏–π:** –ø—Ä–∏ –∫–æ–ª–∏—á–µ—Å—Ç–≤–µ —Å–æ–æ–±—â–µ–Ω–∏–π >200 –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è react-virtuoso (firstItemIndex –¥–ª—è prepend, startReached –¥–ª—è –ø–æ–¥–≥—Ä—É–∑–∫–∏ —Å—Ç–∞—Ä—ã—Ö, followOutput, scroll –∫ –ø–æ—Å–ª–µ–¥–Ω–µ–º—É –ø—Ä–∏ —Å–º–µ–Ω–µ —á–∞—Ç–∞).
- **Workspace v1:** –º–∏–≥—Ä–∞—Ü–∏–∏ organization_invite_links –∏ organization_members; auth-service: GET /api/invite/:token (–ø—É–±–ª–∏—á–Ω–æ), POST /api/invite/:token/accept (—Å Bearer); team-service: POST /api/team/invite-links; —Ñ—Ä–æ–Ω—Ç: —Å—Ç—Ä–∞–Ω–∏—Ü–∞ /invite/[token] (–ø—Ä–∏–Ω—è—Ç—å –ø—Ä–∏–≥–ª–∞—à–µ–Ω–∏–µ), –ø–µ—Ä–µ–∫–ª—é—á–∞—Ç–µ–ª—å –≤–æ—Ä–∫—Å–ø–µ–π—Å–∞ –≤ —Å–∞–π–¥–±–∞—Ä–µ.
- **Audit logs:** –º–∏–≥—Ä–∞—Ü–∏—è audit_logs; –∑–∞–ø–∏—Å—å –≤ auth (organization.updated, ownership_transferred) –∏ team (member_role_changed, invitation_revoked); GET /api/auth/audit-logs (–ø–æ –ø—Ä–∞–≤—É audit.read); –≤–∫–ª–∞–¥–∫–∞ ¬´–ñ—É—Ä–Ω–∞–ª –∞—É–¥–∏—Ç–∞¬ª –≤ –ù–∞—Å—Ç—Ä–æ–π–∫–∞—Ö (owner/admin).
- **–ì—Ä–∞–Ω—É–ª—è—Ä–Ω—ã–µ –ø—Ä–∞–≤–∞:** –º–∏–≥—Ä–∞—Ü–∏—è role_permissions —Å –¥–µ—Ñ–æ–ª—Ç–∞–º–∏; canPermission() –≤ auth –∏ team; –ø—Ä–æ–≤–µ—Ä–∫–∏ –¥–ª—è workspace, audit, team, invitations.
- **–ü–µ—Ä–µ–¥–∞—á–∞ –≤–ª–∞–¥–µ–Ω–∏—è:** —Å–∏–Ω—Ö—Ä–æ–Ω–∏–∑–∞—Ü–∏—è users.role –ø—Ä–∏ transfer-ownership (UPDATE users SET role –¥–ª—è —Å—Ç–∞—Ä–æ–≥–æ –∏ –Ω–æ–≤–æ–≥–æ owner –ø–æ organization_id).
- **Signup:** —É–Ω–∏–∫–∞–ª—å–Ω–æ—Å—Ç—å slug –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–∏ –±–µ–∑ –∏–Ω–≤–∞–π—Ç–∞ (–Ω–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è + –ø—Ä–æ–≤–µ—Ä–∫–∞ + —Å—É—Ñ—Ñ–∏–∫—Å –ø—Ä–∏ –∫–æ–ª–ª–∏–∑–∏–∏).

### –í –ø—Ä–æ—Ü–µ—Å—Å–µ / —Å–ª–µ–¥—É—é—â–∏–π —à–∞–≥

- –ó–∞—â–∏—Ç–∞ –æ—Ç –¥—É–±–ª–µ–π –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∏–Ω–≤–∞–π—Ç–∞ –ø–æ email. –†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –≥—Ä–∞–Ω—É–ª—è—Ä–Ω—ã—Ö –ø—Ä–∞–≤ –Ω–∞ –¥—Ä—É–≥–∏–µ —Å–µ—Ä–≤–∏—Å—ã (messaging, bd-accounts, CRM) –ø—Ä–∏ –Ω–µ–æ–±—Ö–æ–¥–∏–º–æ—Å—Ç–∏.

–î–æ–∫—É–º–µ–Ω—Ç –º–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∫–∞–∫ –µ–¥–∏–Ω—ã–π –±—ç–∫–ª–æ–≥. –†–µ–∞–ª–∏–∑–∞—Ü–∏—è –∏–¥—ë—Ç –ø–æ —Ñ–∞–∑–∞–º; –ø–æ—Å–ª–µ –∫–∞–∂–¥–æ–π –∑–∞–¥–∞—á–∏ –æ–±–Ω–æ–≤–ª—è—Ç—å —Å—Ç–∞—Ç—É—Å –≤ —Ç–∞–±–ª–∏—Ü–∞—Ö –≤—ã—à–µ –∏ —Ä–∞–∑–¥–µ–ª ¬´–ß—Ç–æ —Å–¥–µ–ª–∞–Ω–æ¬ª.
